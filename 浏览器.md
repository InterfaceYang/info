# 						浏览器地址栏输入地址之后……

> 地址栏输入URL会发生什么，这个题目，可以说一年。
>
> ​																						——尼古拉斯·鲁

##### 对比本地浏览器缓存

​		浏览器根据域名，在本地缓存中寻找是否已经访问过，如果访问过，再走强缓存和协商缓存那一套，强缓存，对比过期时间，在合适情况下直接显示当前页面。

##### 根据规则解析url

​		以http://news.baidu.com:80/internet为例，

​		协议部分:http

​		域名部分：news.baidu.com

​		端口：80

​		虚拟目录：/internet

​		根据规则，浏览器组装一个HTTP（Get）请求报文，将输入的域名进行解析，取得域名部分

​		return { http的请求报文 }

##### DNS解析过程

​		虽然上一步中，得到了news.baidu.com域名，但是浏览器是不知道主机在哪的，更无从建立连接和发送请求，因此建立连接的的第一步是通过dns寻址服务，找到域名的目标主机ip（这里不考虑集群cdn等）

​		DNS解析是逐级解析的，过程梳理如下

- 检查浏览器缓存

- 检查内存中dns缓存

- 检查路由器中dns缓存

- 检查本地isp电信提供商的dns缓存

  如果上述缓存中都没有该域名的解析缓存，则逐步向上，直到根目录服务器。

  这个过程主要有迭代查询和递归查询，

  迭代查询：操作系统向dns服务器查询解析记录，如果没有，dns服务器向操作系统返回其他dns服务器，由操作系统迭代进行不停查询。

  递归查询：操作系统向dns服务器查询解析记录，服务器如果没有，则自发查询其他dns服务器的dns记录，最后总会想操作系统返回dns解析记录。

  一般，两种查询过程交互存在。

  > 这里引用一些dns劫持的知识
  >
  > dns劫持一般来说是isp电信提供商，将本该解析ipA的域名，解析到ipB上，从而达到自己的目的

  ​		return {IP地址}

  ##### 三次握手

  ​		根据上个步骤中获得的IP地址，浏览器发送Http请求，由于http请求是应用层的协议，因此依赖处于传输层的TCP/IP协议。

​		![image-20200331213422976](C:\Users\17112598\AppData\Roaming\Typora\typora-user-images\image-20200331213422976.png)



TCP/IP的三次握手：

- 首先client发起请求，将自身SYN=1.发送seq=x到服务端，发送后，自身状态编程SYN-SEND状态

- 服务器Server接受到C发送过来的seq报文，将自身的SYN = 1 ACK =1 同时将将自身状态编程SYN-RECEIVED状态，，同时向C发送seq = 1，ack = x+1 的报文

- 客户端C接受到S发送过来的seq和ack报文，将自身ack= 1，同时自身状态置为ESTABLISHED ，同时向S发送seq = x+1，ack= y+1的报文

- 服务器S接收到客户端的seq和ack报文，将自身状态置为ESTABLISHED 

  SYN和ACK状态解释：

  1. **ACK**：确认标识，用于表示对数据包的成功接收。ACK置为1，表示已经收到seq=x的报文，且已经发还 ack = x+1的报文返回，这里的x是指对方刚才发过来的随机数seq的值

  2. **SYN**：同步标识，表示TCP连接已初始化。

     经过三次握手，tcp链接已经建立，可以进行http请求了。

     

  ##### Http请求



​		

